<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Review Responder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        primary: '#7C90FF',
                        'primary-hover': '#6A7FD6',
                        'primary-light': '#F8F9FF',
                        'gray-border': '#E5E7EB',
                        'gray-text': '#6B7280',
                        'dark-text': '#374151',
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom focus ring */
        textarea:focus, input:focus {
            outline: none;
            border-color: #7C90FF;
            box-shadow: 0 0 0 3px rgba(124, 144, 255, 0.1);
        }
    </style>
</head>
<body class="bg-white min-h-screen font-sans">
    <div class="max-w-2xl mx-auto px-6 py-16">
        
        <!-- Header -->
        <h1 class="text-4xl font-semibold text-center text-black tracking-tight mb-2">Review responder</h1>
        <p class="text-gray-text text-center mb-10">Paste a review below to generate a professional reply.</p>

        <!-- Input Form (shown when no result) -->
        <div id="input-section">
            <!-- Review textarea -->
            <textarea 
                id="review-input"
                placeholder="Paste the customer review here..."
                class="w-full h-44 p-5 border border-gray-border rounded-xl text-dark-text text-base resize-none mb-4"
            ></textarea>

            <!-- Business name input -->
            <input 
                type="text"
                id="business-name"
                placeholder="Add your business name (optional)"
                class="w-full p-4 border border-gray-border rounded-xl text-dark-text text-base mb-8"
            >

            <!-- Tone selector -->
            <p class="text-gray-text text-center text-base mb-5">What tone would you like to reply with?</p>
            
            <div class="flex justify-center gap-4 mb-10">
                <button 
                    class="tone-btn px-7 py-3 border border-gray-border rounded-lg text-dark-text font-medium text-base transition-all hover:border-primary selected"
                    data-tone="Grateful"
                >Grateful</button>
                <button 
                    class="tone-btn px-7 py-3 border border-gray-border rounded-lg text-dark-text font-medium text-base transition-all hover:border-primary"
                    data-tone="Polite & Firm"
                >Polite & Firm</button>
                <button 
                    class="tone-btn px-7 py-3 border border-gray-border rounded-lg text-dark-text font-medium text-base transition-all hover:border-primary"
                    data-tone="Short"
                >Short</button>
            </div>

            <!-- Generate button -->
            <div class="flex justify-center">
                <button 
                    id="generate-btn"
                    class="bg-primary hover:bg-primary-hover text-white font-medium text-base px-10 py-3.5 rounded-lg shadow-md transition-all"
                >Generate reply</button>
            </div>
        </div>

        <!-- Result Section (hidden initially) -->
        <div id="result-section" class="hidden">
            <!-- Original review display -->
            <div id="review-display" class="w-full p-5 border border-gray-border rounded-xl text-dark-text text-base mb-4 leading-relaxed"></div>
            
            <!-- Business name display -->
            <div id="business-display" class="w-full p-4 border border-gray-border rounded-xl text-dark-text text-base mb-6 hidden"></div>

            <!-- Your reply heading -->
            <h2 class="text-2xl font-semibold text-center text-black mt-8 mb-4">Your reply</h2>

            <!-- Generated reply box -->
            <div id="reply-output" class="w-full p-6 bg-primary-light border border-indigo-100 rounded-xl text-dark-text text-base leading-relaxed mb-10"></div>

            <!-- Buttons -->
            <div class="flex justify-center gap-4">
                <button 
                    id="copy-btn"
                    class="bg-primary hover:bg-primary-hover text-white font-medium text-base px-10 py-3.5 rounded-lg shadow-md transition-all"
                >Copy reply</button>
                <button 
                    id="reset-btn"
                    class="bg-white hover:border-primary text-dark-text font-medium text-base px-10 py-3.5 rounded-lg border border-gray-border transition-all"
                >Reply to another</button>
            </div>
        </div>

        <!-- Loading state -->
        <div id="loading-section" class="hidden text-center py-12">
            <div class="inline-block w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin mb-4"></div>
            <p class="text-gray-text">Generating your reply...</p>
        </div>

    </div>

    <script>
        // State
        let selectedTone = 'Grateful';

        // Elements
        const inputSection = document.getElementById('input-section');
        const resultSection = document.getElementById('result-section');
        const loadingSection = document.getElementById('loading-section');
        const reviewInput = document.getElementById('review-input');
        const businessName = document.getElementById('business-name');
        const generateBtn = document.getElementById('generate-btn');
        const resetBtn = document.getElementById('reset-btn');
        const copyBtn = document.getElementById('copy-btn');
        const toneButtons = document.querySelectorAll('.tone-btn');
        const reviewDisplay = document.getElementById('review-display');
        const businessDisplay = document.getElementById('business-display');
        const replyOutput = document.getElementById('reply-output');

        // Tone button selection
        toneButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                toneButtons.forEach(b => b.classList.remove('selected', 'border-primary', 'bg-primary-light', 'text-primary'));
                btn.classList.add('selected', 'border-primary', 'bg-primary-light', 'text-primary');
                selectedTone = btn.dataset.tone;
            });
        });

        // Set initial selected state
        document.querySelector('.tone-btn.selected').classList.add('border-primary', 'bg-primary-light', 'text-primary');

        // Generate reply
        generateBtn.addEventListener('click', async () => {
            const review = reviewInput.value.trim();
            if (!review) {
                reviewInput.focus();
                return;
            }

            // Show loading
            inputSection.classList.add('hidden');
            loadingSection.classList.remove('hidden');

            try {
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        review: review,
                        businessName: businessName.value.trim() || 'The Business',
                        tone: selectedTone
                    })
                });

                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }

                // Show result
                reviewDisplay.textContent = review;
                
                if (businessName.value.trim()) {
                    businessDisplay.textContent = businessName.value.trim();
                    businessDisplay.classList.remove('hidden');
                } else {
                    businessDisplay.classList.add('hidden');
                }
                
                replyOutput.textContent = data.reply;
                
                loadingSection.classList.add('hidden');
                resultSection.classList.remove('hidden');

            } catch (error) {
                console.error('Error:', error);
                alert('Something went wrong. Please try again.');
                loadingSection.classList.add('hidden');
                inputSection.classList.remove('hidden');
            }
        });

        // Reset / Reply to another
        resetBtn.addEventListener('click', () => {
            reviewInput.value = '';
            businessName.value = '';
            resultSection.classList.add('hidden');
            inputSection.classList.remove('hidden');
            reviewInput.focus();
        });

        // Copy reply to clipboard
        copyBtn.addEventListener('click', async () => {
            const replyText = replyOutput.textContent;
            
            try {
                await navigator.clipboard.writeText(replyText);
                
                // Visual feedback
                const originalText = copyBtn.textContent;
                copyBtn.textContent = 'Copied!';
                copyBtn.classList.add('bg-green-500', 'hover:bg-green-600');
                copyBtn.classList.remove('bg-primary', 'hover:bg-primary-hover');
                
                setTimeout(() => {
                    copyBtn.textContent = originalText;
                    copyBtn.classList.remove('bg-green-500', 'hover:bg-green-600');
                    copyBtn.classList.add('bg-primary', 'hover:bg-primary-hover');
                }, 2000);
                
            } catch (err) {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = replyText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                copyBtn.textContent = 'Copied!';
                setTimeout(() => {
                    copyBtn.textContent = 'Copy reply';
                }, 2000);
            }
        });
    </script>
</body>
</html>
